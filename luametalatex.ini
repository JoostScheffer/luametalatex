% Based on lualatex.ini, originally written 2008 by Karl Berry. Public domain.

\input luametatexconfig.tex

\begingroup
  \catcode`\{=1 %
  \catcode`\}=2 %
  % Set up job name quoting before latex.ltx
  % Web2c pdfTeX/XeTeX quote job names containing spaces, but LuaTeX does
  % not do this at the engine level. The behaviour can be changed using
  % a callback. Originally this code was loaded via lualatexquotejobname.tex
  % but that required a hack around latex.ltx: the behaviour has been altered
  % to allow the callback route to be used directly.
  \global\everyjob{\directlua{require("lualatexquotejobname.lua")}}
  \global\chardef\eTeXversion=2
  \global\def\eTeXrevision{.2}
\endgroup

\let\LMLTsaveddump\dump
\let\dump\relax
\let\tracingmarks\undefined
\input latex.ltx
\let\dump\LMLTsaveddump
%
\makeatletter
\def\set@fontsize#1#2#3{%
  \@defaultunits\@tempdimb#2pt\relax\@nnil
  \edef\f@size{\strip@pt\@tempdimb}%
  \@defaultunits\@tempdimc#3pt\relax\@nnil
  \edef\f@baselineskip{\the\@tempdimc}%
  \edef\f@linespread{#1}%
  \let\baselinestretch\f@linespread
  \def\size@update{%
    \baselineskip\f@baselineskip\relax
    \baselineskip\f@linespread\baselineskip
    \normalbaselineskip\baselineskip
    \setbox\strutbox\hbox{%
      \vrule\@height.7\baselineskip
            \@depth.3\baselineskip
            \@width\z@}%
    \let\size@update\relax}%
}
\makeatother
\AddToHook{package/microtype/after}[luametalatex]{%
  \input{luametalatex-microtype.sty}%
}%
%
\dump
